---
creation date: 2021-12-09 11:43
modification date: Thursday 9th December 2021 11:43:34
---

# README - Centricams
The `Centricams.img` SD card image can be applied to any 16gb or larger SD card using the [Raspberry Pi Imager](https://www.raspberrypi.com/software/) tool.
This image is a pre-made build of the tools and scripts needed to automatically stream USB webcam and Pi Image Unit video over an `http` link.
Any number of USB devices can be served as the addresses to each of USB devices are dynamically generated.

## Accessing Video Feeds
The streaming platform utilises the [mjpg-streamer](https://github.com/jacksonliam/mjpg-streamer) package with the Video4Linux plugin (`input_uvc`).
**The stream is scheduled to start 60 seconds after the device boots up (2 mins. total approx)**
The default `output_http` settings are used with HTTP port 8090, hence accessing the streams is done as follows:
- For one camera:
```http
http://<static_ip>:8090/?action=stream
```
- For more than one camera (`n` is the index of camera, where `0` is the first camera):
```http
http://<static_ip>:8090/?action=stream_0
http://<static_ip>:8090/?action=stream_n
...
```

## Important Files
### Cron and `startup_script.sh`
*You shouldn't need to edit these files*
The [crontab](https://www.adminschoice.com/crontab-quick-reference) command is used to schedule the running of the required scripts @startup.
The scheduling can be modified by typing at the command line:
```bash
sudo crontab -e
```
The last line of this file is used to run `startup_script.sh` 60 seconds after boot/reboot.

`startup_script.sh`  is located on the Desktop (`~/Desktop/startup_script.sh`) and contains instructions to run the python file `Centricams.py`.


### [Assigning a static IP with `dchpcd.conf`](https://thepihut.com/blogs/raspberry-pi-tutorials/how-to-give-your-raspberry-pi-a-static-ip-address-update)
When using a new raspi board, a new static IP address will need to be assigned.
Summarising the above link, to change the static IP of the raspi:
- Edit the dhcpcd.conf file
```bash
sudo nano /etc/dhcpcd.conf
```
- Edit the IP address under the `interface eth0` line, ensuring `/24` is at the end
```nano
static ip_address=<your_new_ip>/24
```
- Save changes by pressing <kbd>Ctrl</kbd> + <kbd>x</kbd>, then <kbd>y</kbd>, then <kbd>Enter</kbd>
- You can see if changes have been made by typing at the command line:
```bash
ifconfig
```

### `Centricams.py` and `CamProbe.py`
This is the main file that manages [mjpg-streamer](https://github.com/jacksonliam/mjpg-streamer). 
Functionally `CamProbe.py` queries what devices are connected to the Raspi board and if an image can be recorded from them (i.e. they are webcams).
For each valid device, a string is generated by `Centricams.py` that is passed to [mjpg-streamer](https://github.com/jacksonliam/mjpg-streamer) at the command line.
**Do not edit the `subprocess` commands they are very prone to error**

Optionally, when a raspi camera is connected to the board, it is assumed that this needs to be streamed, so a command is also passed to stream the raspi camera feed.

#### Editing camera properties
Three camera properties are availible to edit with the Centricams.py file:
- X resolution (line 27)
- Y resolution (line 28)
- Frames Per Second (line 29)

The default values are 640x480@30fps, **increasing the quality of image will come with a performance cost**.
On a Raspi model 3+ board, 1280x720 should be possible for two streams.
